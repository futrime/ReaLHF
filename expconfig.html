

<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="ReaL" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="0.1.0" />
    <meta name="docsearch:version" content="" />
    
      <title>Configurations &mdash; ReaL 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/bootstrap-icons.css" type="text/css" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/pygments.css', priority=200, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=83e35b93" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/custom.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="_static/custom.css?v=97da1bf0" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/pygments_dark.css', priority=500, rel='stylesheet', type='text/css', media='(prefers-color-scheme: dark)', id='pygments_dark_css')" -->
          <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="_static/pygments_dark.css?v=b20cc3f5" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/colorsets/sphinx-nefertiti-default-0.3.4.min.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="_static/colorsets/sphinx-nefertiti-default-0.3.4.min.css" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/fonts/nunito/stylesheet.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="_static/fonts/nunito/stylesheet.css" />
          <!-- add (1) pathto "_CascadingStyleSheet('_static/fonts/red-hat-mono/stylesheet.css', priority=500, rel='stylesheet', type='text/css')" -->
          <link rel="stylesheet" type="text/css" href="_static/fonts/red-hat-mono/stylesheet.css" />
        <link rel="index" title="Index" href="genindex.html" />
        <link rel="search" title="Search" href="search.html" />
        <link rel="top" title="ReaL 0.1.0 documentation" href="#" />
        <link rel="next" title="Quickstart" href="quickstart.html" />
        <link rel="prev" title="Installation" href="install.html" />
    <style>
      :root {
        --nftt-body-font-family: "Nunito", var(--nftt-font-sans-serif) !important;
        --nftt-font-monospace: "Red Hat Mono", var(--nftt-font-family-monospace) !important;
        --nftt-project-name-font: var(--nftt-body-font-family);
        --nftt-documentation-font: var(--nftt-body-font-family);
        --nftt-doc-headers-font: "Georgia", var(--nftt-documentation-font);}
      h1 *, h2 *, h3 *, h4 *, h5 *, h6 * { font-size: inherit; }
    </style>
  </head>
  <body>
    <header class="navbar navbar-expand-xl navbar-dark nftt-navbar flex-column fixed-top">
      <div class="skip-links container-fluid visually-hidden-focusable overflow-hidden justify-content-start flex-grow-1">
        <div class="border-bottom mb-2 pb-2 w-100">
          <a class="d-none d-md-inline-flex p-2 m-1" href="#sidebar-filter">Skip to docs navigation</a>
          <a class="d-inline-flex p-2 m-1" href="#content">Skip to main content</a>
        </div>
      </div>
      <nav class="container-xxl nftt-gutter flex-wrap flex-xl-nowrap" aria-label="Main navigation">
        <div class="nftt-navbar-toggler">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle documentation navigation">
            <i class="bi bi-list"></i>
          </button>
        </div>
          <a href="index.html"
              
              class="navbar-brand p-0 me-0 md-lg-2"
          ><span class="brand-text">ReaL</span></a>
        
        <div class="d-flex d-xl-none">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttSearch" aria-controls="nfttSearch" aria-label="Search">
            <i class="bi bi-search"></i>
          </button>
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttNavbar" aria-controls="nfttNavbar" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
        
<div class="offcanvas-xl offcanvas-end flex-grow-1" tabindex="-1" id="nfttSearch" aria-labelledby="nfttSearchOffcanvasLabel" data-bs-scroll="true">
  <div class="offcanvas-header px-4 pb-0">
    <h5 class="offcanvas-title fw-bold" id="nfttSearchOffcanvasLabel">Search the documentation</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttSearch"></button>
  </div>
  <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
    <hr class="d-xl-none text-white-50">
    <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
      <li class="nav-item col-12 col-xl-auto">
        <form id="nftt-search-form" action="search.html" method="get">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search docs" aria-label="Search" aria-describedby="button-search">
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <button class="btn btn-primary" type="submit" id="button-search" aria-label="Search"><i class="bi bi-search"></i></button>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

        <div class="offcanvas-xl offcanvas-end" tabindex="-1" id="nfttNavbar" aria-labelledby="nfttNavbarOffcanvasLabel" data-bs-scroll="true">
          <div class="offcanvas-header px-4 pb-0">
            <div class="offcanvas-title navbar-brand" id="nfttNavbarOffcanvasLabel"><span class="brand-text">Nefertiti for Sphinx</span></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttNavbar"></button>
          </div>
          <div class="offcanvas-body p-4 pt-0 p-xl-0 px-xl-3">
            <hr class="d-xl-none text-white-50">
            <ul class="navbar-nav flex-row align-items-center flex-wrap ms-lg-auto">
              
              <!-- version_dropdown.html -->

              
              <!-- colorscheme_dropdown.html -->
<li class="nav-item dropdown">
  <a class="nav-link d-flex py-2 px-0 px-xl-2 dropdown-toggle align-items-center" id="snftt-luz" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false" aria-label="Toggle light/dark">
    <i class="bi bi-circle-half" data-snftt-luz-icon-active></i>
    <span id="snftt-luz-text" class="d-xl-none small ms-2">Toggle light/dark</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-luz-text">
    <li>
      <h6 class="dropdown-header">Light/dark</h6>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="light" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-sun" data-snftt-luz-icon="light"></i>
        </span>
        <span class="small ms-3">Light</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="dark" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-moon-stars" data-snftt-luz-icon="dark"></i>
        </span>
        <span class="small ms-3">Dark</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item current d-flex align-items-center" data-snftt-luz="default" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-circle-half" data-snftt-luz-icon="default"></i>
        </span>
        <span class="small ms-3">Default</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
  </ul>
</li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container-fluid flex-grow-1">
      <div class="nftt-gutter nftt-page">
        <aside class="nftt-sidebar ">
          <div class="nftt-sidebar-content">
            
            <div class="title d-none d-xl-block">
              <i class="bi bi-book"></i>&nbsp;&nbsp;<span>Index</span>
            </div>
            <div id="sidebar" tabindex="-1" class="offcanvas-xl offcanvas-start" aria-labelledby="nfttSidebarOffcanvasLabel">
                <!-- danirus sidebartemplate: "globaltoc.html" --><div class="offcanvas-header border-bottom">
  <h5 class="offcanvas-title fw-bold" id="nfttSidebarOffcanvasLabel">
    Table of contents
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#sidebar"></button>
</div>

<div class="offcanvas-body">
  <nav class="toc" aria-label="Main menu">
    <div class="mb-3 p-1 pt-3 pb-4 border-bottom">
      <input id="sidebar-filter" type="text" name="filter" class="form-control form-control-sm" placeholder="filter" aria-label="filter">
    </div>
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">Setting Up Distributed Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

  </nav>
  <template data-toggle-item-template>
    <button class="btn btn-sm btn-link toctree-expand" type="button">
      <i class="bi bi-caret-right"></i>
      <span class="visually-hidden">Toggle menu contents</span>
    </button>
  </template>
</div>
            </div>
            
          </div>
        </aside>
        <article id="content" class="nftt-content" role="main">
    <section id="configurations">
<h1>Configurations<a class="headerlink" href="#configurations" title="Link to this heading">¶</a></h1>
<p>We illustrate configurations for quickstart experiments in this page.
Each type of experiment (e.g., SFT, PPO) corresponds to a specific
configuration object (e.g., <a class="reference internal" href="#realhf.SFTConfig" title="realhf.SFTConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">realhf.SFTConfig</span></code></a> for SFT).</p>
<p>Since ReaL uses <a class="reference external" href="https://hydra.cc/">Hydra</a> for configuration management,
users can override these options provided by the class recursively
with command line arguments.
Please check <a class="reference internal" href="quickstart.html"><span class="doc">Quickstart</span></a> for concrete examples.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page serves as a reference manual for the configuration objects,
i.e., you can check which attributes can be modified and their default values.
You don’t need to read through this page before running experiments!</p>
</div>
<section id="experiment-configurations">
<h2>Experiment Configurations<a class="headerlink" href="#experiment-configurations" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="realhf.ExperimentSaveEvalControl">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">ExperimentSaveEvalControl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">total_train_epochs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_freq_epochs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_freq_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_freq_secs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_freq_epochs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_freq_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eval_freq_secs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchmark_steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.ExperimentSaveEvalControl" title="Link to this definition">¶</a></dt>
<dd><p>Utility object for controlling the frequency of saving and evaluation.</p>
<p><code class="docutils literal notranslate"><span class="pre">Epoch</span></code> means the number of times the training loop goes through the entire dataset.
<code class="docutils literal notranslate"><span class="pre">Step</span></code> means the number of iterations running the algorithm dataflow.</p>
<p>This object has independent counters for epochs, steps, and seconds.
Models will be saved or evaluated when any of the following conditions are met.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>total_train_epochs</strong> (<em>int</em>) – The total number of epochs to train the model.</p></li>
<li><p><strong>save_freq_epochs</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Save the model every this number of epochs.
If None, the model will not be saved if the epoch number changes during training.</p></li>
<li><p><strong>save_freq_steps</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Save the model every this number of steps.
If None, the model will not be saved if the step number changes during training.</p></li>
<li><p><strong>save_freq_secs</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Save the model every this number of seconds.
If None, the model will not be saved if the time changes during training.</p></li>
<li><p><strong>eval_freq_epochs</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Evaluate the model every this number of epochs.
If None, the model will not be evaluated if the epoch number changes during training.</p></li>
<li><p><strong>eval_freq_steps</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Evaluate the model every this number of steps.
If None, the model will not be evaluated if the step number changes during training.</p></li>
<li><p><strong>eval_freq_secs</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Evaluate the model every this number of seconds.
If None, the model will not be evaluated if the time changes during training.</p></li>
<li><p><strong>benchmark_steps</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Terminate the training after this number of steps.
Used by system benchmark only. Please leave it to None for normal training.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.CommonExperimentConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">CommonExperimentConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'slurm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'dev'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wandb_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_retries:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_worker_error:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'pipe_model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_use_cache:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_nodes:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_gpus_per_node:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodelist:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_ctrl:</span> <span class="pre">~realhf.api.core.system_api.ExperimentSaveEvalControl</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.CommonExperimentConfig" title="Link to this definition">¶</a></dt>
<dd><p>The common config for quickstart experiments.</p>
<p>All members can be changed by the user in the command line,
e.g.,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>realhf.apps.quickstart<span class="w"> </span>sft<span class="w"> </span><span class="nv">trial_name</span><span class="o">=</span>my_trial<span class="w"> </span><span class="nv">seed</span><span class="o">=</span><span class="m">42</span><span class="w"> </span>exp_ctrl.save_freq_steps<span class="o">=</span><span class="m">10</span><span class="w"> </span>...
</pre></div>
</div>
<p>The above command changes the <code class="docutils literal notranslate"><span class="pre">trial_name</span></code>, the <code class="docutils literal notranslate"><span class="pre">seed</span></code> attribute,
and the <code class="docutils literal notranslate"><span class="pre">save_freq_steps</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">exp_ctrl</span></code> attribute
of this class.</p>
<p><code class="docutils literal notranslate"><span class="pre">recover_mode</span></code> is one of the followings:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">auto</span></code>: automatically recover the last failed run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save</span></code>: save recover states if any error occurs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resume</span></code>: resume from saved recover states and save states if fail again.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">disabled</span></code>: do nothing but raise error when error occurs.</p></li>
</ul>
<p>If you don’t know how ReaL’s recovery works, set it to be <code class="docutils literal notranslate"><span class="pre">disabled</span></code>.
Normal checkpointing is usually sufficient for most cases.</p>
<p><code class="docutils literal notranslate"><span class="pre">allocation_mode</span></code> is one of the followings:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">manual</span></code>: manually allocate resources with given commandline options.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search</span></code>: allocate resources and configure parallel strategies with the search engine.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">heuristic</span></code>: allocate resources and configure parallel strategies with heuristic strategies previously obtained by search.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipe_data</span></code>: identical parallelization (like DSChat) with pipe+data parallelism. A world size under 8 will use data parallelism only.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipe_model</span></code>: identical parallelization (like DSChat) with pipe+model parallelism. A world size under 8 will use tensor-model parallelism only.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> (<em>str</em>) – Name of the experiment. Arbitrary string without “-” and “/”, e.g., <code class="docutils literal notranslate"><span class="pre">ultra-chat-llama</span></code>.</p></li>
<li><p><strong>trial_name</strong> (<em>str</em>) – Name of the trial. Arbitrary string without “-” and “/”, e.g., <code class="docutils literal notranslate"><span class="pre">lr1e-3wd0.05</span></code>.</p></li>
<li><p><strong>mode</strong> (<em>str</em>) – Experiment launching mode. “local”, “ray”, or “slurm” are supported.
“ray” mode requires launching the ray cluster with CLI.
“slurm” mode requires the pyxis plugin with enroot container enabled.
The “local” mode implies <code class="docutils literal notranslate"><span class="pre">n_nodes=1</span></code>.</p></li>
<li><p><strong>debug</strong> (<em>bool</em>) – Whether to run in the debug mode.
Setting to <cite>False</cite> will disable all assertions, which will be unsafe but faster.</p></li>
<li><p><strong>partition</strong> (<em>str</em>) – The slurm partition to run the experiment.</p></li>
<li><p><strong>wandb_mode</strong> (<em>str</em>) – The mode of wandb. Currently the wandb logging is not supported.</p></li>
<li><p><strong>image_name</strong> (<em>str</em><em> or </em><em>None</em>) – The name of the docker image used by the controller.
Only used in the slurm mode.</p></li>
<li><p><strong>recover_mode</strong> (<em>str</em>) – The recover mode. See above.</p></li>
<li><p><strong>recover_retries</strong> (<em>int</em>) – The number of retries for recovery.
Only effective when recover_mode is “auto”.</p></li>
<li><p><strong>ignore_worker_error</strong> (<em>bool</em>) – Whether to ignore errors raised by
workers during runtime. Please do not set it to be True unless
the user is sure that some error is ignorable.
Only effective when recover_mode is “disabled”.</p></li>
<li><p><strong>allocation_mode</strong> (<em>str</em>) – Mode of GPU parallel strategy allocation. See above.</p></li>
<li><p><strong>allocation_use_cache</strong> (<em>bool</em>) – Whether to use cache in allocation search.
Only effective when allocation_mode==”search”
and cache is available in the log dir of current experiment
name and trial.</p></li>
<li><p><strong>n_nodes</strong> (<em>int</em>) – Number of nodes to run the experiment.</p></li>
<li><p><strong>n_gpus_per_node</strong> (<em>int</em>) – Number of GPUs per node.
Thus, the total number of GPUs will be <code class="docutils literal notranslate"><span class="pre">n_nodes</span> <span class="pre">*</span> <span class="pre">n_gpus_per_node</span></code>.
ReaL supports a world size of 1, 2, 4, 8, … within a single node,
or multiple nodes with the same number of GPUs.</p></li>
<li><p><strong>nodelist</strong> (<em>str</em><em> or </em><em>None</em>) – Nodelist for the distributed setting in SLURM nodelist format.
Required for the <code class="docutils literal notranslate"><span class="pre">manual</span></code> allocation mode.
For several GPUs on a single node, it should be like “NODE01:0,1,2,3”,
meaning that using the first 4 GPUs on the <code class="docutils literal notranslate"><span class="pre">NODE01</span></code> node.
For several complete nodes, it should be like “NODE[01-02,03,07],COM08”,
meaning that using all GPUs for these nodes: [NODE01, NODE02, NODE03, NODE07, COM08].</p></li>
<li><p><strong>seed</strong> (<em>int</em>) – Random seed.</p></li>
<li><p><strong>exp_ctrl</strong> (<a class="reference internal" href="#realhf.ExperimentSaveEvalControl" title="realhf.ExperimentSaveEvalControl"><em>ExperimentSaveEvalControl</em></a>) – The save and evaluation control of the experiment.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.SFTConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">SFTConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'slurm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'dev'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wandb_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_retries:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_worker_error:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'pipe_model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_use_cache:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_nodes:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_gpus_per_node:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodelist:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_ctrl:</span> <span class="pre">~realhf.api.core.system_api.ExperimentSaveEvalControl</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset:</span> <span class="pre">~realhf.api.quickstart.dataset.PromptAnswerDatasetConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.SFTConfig" title="Link to this definition">¶</a></dt>
<dd><p>SFT experiment configuration.</p>
<p>It is a subclass of <a class="reference internal" href="#realhf.CommonExperimentConfig" title="realhf.CommonExperimentConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonExperimentConfig</span></code></a>,
so all CLI options in the base class are available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Model runtime configuration.</p></li>
<li><p><strong>allocation</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – Device allocation and parallelism configuration.</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="#realhf.PromptAnswerDatasetConfig" title="realhf.PromptAnswerDatasetConfig"><em>PromptAnswerDatasetConfig</em></a>) – Dataset configuration</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.RWConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">RWConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'slurm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'dev'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wandb_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_retries:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_worker_error:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'pipe_model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_use_cache:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_nodes:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_gpus_per_node:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodelist:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_ctrl:</span> <span class="pre">~realhf.api.core.system_api.ExperimentSaveEvalControl</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sft_lora:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sft_lora_path:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset:</span> <span class="pre">~realhf.api.quickstart.dataset.PairedComparisonDatasetConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.RWConfig" title="Link to this definition">¶</a></dt>
<dd><p>Pairwise reward modeling experiment configuration.</p>
<p>It is a subclass of <a class="reference internal" href="#realhf.CommonExperimentConfig" title="realhf.CommonExperimentConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonExperimentConfig</span></code></a>,
so all CLI options in the base class are available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>is_sft_lora</strong> (<em>bool</em>) – Whether LoRA was used for SFT.
If so, the saved SFT model should only contain LoRA parameters.
Since LoRA is currently not supported for SFT,
this option is not used for now.</p></li>
<li><p><strong>sft_lora_path</strong> – Path to the LoRA model for SFT.
Since LoRA is currently not supported for SFT,
this option is not used for now.</p></li>
<li><p><strong>model</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Model runtime configuration.</p></li>
<li><p><strong>allocation</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – Device allocation and parallelism configuration.</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="#realhf.PairedComparisonDatasetConfig" title="realhf.PairedComparisonDatasetConfig"><em>PairedComparisonDatasetConfig</em></a>) – Dataset configuration.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.DPOConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">DPOConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'slurm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'dev'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wandb_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_retries:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_worker_error:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'pipe_model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_use_cache:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_nodes:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_gpus_per_node:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodelist:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_ctrl:</span> <span class="pre">~realhf.api.core.system_api.ExperimentSaveEvalControl</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sft_lora:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sft_lora_path:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_train:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_inf:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset:</span> <span class="pre">~realhf.api.quickstart.dataset.PairedComparisonDatasetConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.DPOConfig" title="Link to this definition">¶</a></dt>
<dd><p>Direct Preference Optimization (DPO) experiment configuration.</p>
<p>It is a subclass of <a class="reference internal" href="#realhf.CommonExperimentConfig" title="realhf.CommonExperimentConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonExperimentConfig</span></code></a>,
so all CLI options in the base class are available.</p>
<p>We don’t implement runtime evaluation for DPO.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>is_sft_lora</strong> (<em>bool</em>) – Whether LoRA was used for SFT.
If so, the saved SFT model should only contain LoRA parameters.
Since LoRA is currently not supported for SFT,
this option is not used for now.</p></li>
<li><p><strong>sft_lora_path</strong> – Path to the LoRA model for SFT.
Since LoRA is currently not supported for SFT,
this option is not used for now.</p></li>
<li><p><strong>actor</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Runtime configuration of the primary LLM.</p></li>
<li><p><strong>ref</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Runtime configuration of the reference LLM.
This model is only used for inference to provide KL regularization.
In ReaL, this model is automatically offloaded to CPU.
As a result, training DPO is as efficient as training a single LLM.</p></li>
<li><p><strong>actor_train</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – Device allocation and parallelism configuration for
running training on the primary LLM.</p></li>
<li><p><strong>ref_inf</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – Device allocation and parallelism configuration for
running inference on the reference LLM.
This can be different from the training allocation.
A large data parallel degree with additional pipelining
can be faster for inference.</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="#realhf.PairedComparisonDatasetConfig" title="realhf.PairedComparisonDatasetConfig"><em>PairedComparisonDatasetConfig</em></a>) – Dataset configuration. The same for reward modeling.</p></li>
<li><p><strong>beta</strong> (<em>float</em>) – KL regularization coefficient.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.GenerationHyperparameters">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">GenerationHyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_new_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_new_tokens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">greedy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top_p</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top_k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temperature</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_cuda_graph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.GenerationHyperparameters" title="Link to this definition">¶</a></dt>
<dd><p>Generation hyperparameters.</p>
<p>We implement a customized generation function instead of
using HuggingFace’s to support pipelined generation.
As a result, advanced generation techniques like
diversity-promoting sampling or repeatition penalty
are not supported during PPO training.
However, we don’t find it to be a problem in practice.
Increasing the sampling temperature and enabling
top-k/top-p sampling can produce good models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_new_tokens</strong> (<em>int</em>) – The maximum number of new tokens to generate.</p></li>
<li><p><strong>min_new_tokens</strong> (<em>int</em>) – The minimum number of new tokens to generate.</p></li>
<li><p><strong>greedy</strong> (<em>bool</em>) – Whether to use greedy decoding.</p></li>
<li><p><strong>top_k</strong> (<em>int</em>) – The number of highest probability tokens to keep.</p></li>
<li><p><strong>top_p</strong> (<em>float</em>) – The cumulative probability of the highest probability tokens to keep.</p></li>
<li><p><strong>temperature</strong> (<em>float</em>) – The temperature of the sampling process.</p></li>
<li><p><strong>num_samples</strong> (<em>int</em>) – The number of samples to generate.
Should only be enabled for pure generation.
Must be 1 for PPO generation.</p></li>
<li><p><strong>use_cuda_graph</strong> (<em>bool</em>) – Whether to use CUDA graph to reduce kernel launch overhead
during generation. Recommended for pure generation.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.PPOHyperparameters">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">PPOHyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gen:</span> <span class="pre">~realhf.api.core.model_api.GenerationHyperparameters</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_no_logits_mask:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppo_n_minibatches:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kl_ctl:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">discount:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gae_lambda:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_clip:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_eps_clip:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_reward_clip:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">20.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_output_scaling:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_output_bias:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">early_stop_imp_ratio:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_adaptive_kl_ctl:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adv_norm:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_norm:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_norm_type:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'exp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_norm_beta:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.99995</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_norm_eps:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1e-05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.PPOHyperparameters" title="Link to this definition">¶</a></dt>
<dd><p>Configuration of PPO hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gen</strong> (<a class="reference internal" href="#realhf.GenerationHyperparameters" title="realhf.GenerationHyperparameters"><em>GenerationHyperparameters</em></a>) – Generation hyperparameters.</p></li>
<li><p><strong>force_no_logits_mask</strong> (<em>bool</em>) – Whether to omit logits mask.
The logits mask will be produced when using top-k or top-p sampling,
where it is used to mark tokens that are filtered out.
This mask will be used by the reference model and the actor model
during training in order to align inferred logits with that during
generation and produce accurate KLs.
Logits mask with top-k/top-p sampling will largely improve the
stability of PPO training because it narrows the action space.
However, this benefit does not come for free.
The logits mask will occupy a large amount of additional GPU memory.
If this option is set to True, logits mask will be forcely omitted to
save GPU memory, but the learning performance may also drop.</p></li>
<li><p><strong>ppo_n_minibatches</strong> (<em>int</em>) – Number of minibatches in each PPO update.</p></li>
<li><p><strong>kl_ctl</strong> (<em>float</em>) – Coefficient of KL divergence rewards.</p></li>
<li><p><strong>discount</strong> (<em>float</em>) – Discount factor.</p></li>
<li><p><strong>gae_lambda</strong> (<em>float</em>) – Lambda factor in GAE.</p></li>
<li><p><strong>eps_clip</strong> (<em>float</em>) – PPO actor probability ratio clipping factor.</p></li>
<li><p><strong>value_eps_clip</strong> (<em>float</em>) – PPO value clipping factor.</p></li>
<li><p><strong>max_reward_clip</strong> (<em>float</em>) – Maximum reward value.</p></li>
<li><p><strong>reward_output_scaling</strong> (<em>float</em>) – Scaling factor of the reward model output.</p></li>
<li><p><strong>reward_output_bias</strong> (<em>float</em>) – Bias of the reward model output.
The number outputed by the reward model will be
CLIP((x - bias) * scaling, -max_reward_clip, max_reward_clip).</p></li>
<li><p><strong>early_stop_imp_ratio</strong> (<em>float</em>) – PPO update will be early stopped if importance ratio
exceeds this maximum value.</p></li>
<li><p><strong>use_adaptive_kl_ctl</strong> (<em>bool</em>) – Whether to use adaptive KL divergence coefficient.</p></li>
<li><p><strong>adv_norm</strong> (<em>bool</em>) – Whether to use advantage normalization.</p></li>
<li><p><strong>value_norm</strong> (<em>bool</em>) – Whether to denormalize valued and normalize return predictions.</p></li>
<li><p><strong>value_norm_type</strong> (<em>str</em>) – Type of value normalization.
Either exponential moving average (“exp”) or moving average (“ma”).</p></li>
<li><p><strong>value_norm_beta</strong> (<em>float</em>) – Exponential decay factor
in exponential moving average.</p></li>
<li><p><strong>value_norm_eps</strong> (<em>float</em>) – Epsilon factor in the
denominator of exponential moving average.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.PPOConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">PPOConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'slurm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'dev'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wandb_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_retries:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_worker_error:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'pipe_model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_use_cache:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_nodes:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_gpus_per_node:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodelist:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_ctrl:</span> <span class="pre">~realhf.api.core.system_api.ExperimentSaveEvalControl</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sft_lora:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sft_lora_path:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_rew_lora:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rew_lora_path:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rew_head_path:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rew:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_train:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_train:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_gen:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_inf:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rew_inf:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_inf:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset:</span> <span class="pre">~realhf.api.quickstart.dataset.PromptOnlyDatasetConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppo:</span> <span class="pre">~realhf.experiments.common.ppo_exp.PPOHyperparameters</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.PPOConfig" title="Link to this definition">¶</a></dt>
<dd><p>PPO experiment configuration.</p>
<p>It is a subclass of <a class="reference internal" href="#realhf.CommonExperimentConfig" title="realhf.CommonExperimentConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonExperimentConfig</span></code></a>,
so all CLI options in the base class are available.</p>
<p>We don’t implement runtime evaluation for PPO.</p>
<p>We identify that the RLHF process is composed of four
distinct models with independent parameters and six
<em>model function calls</em> upon these models.</p>
<p>The four models are:</p>
<ul class="simple">
<li><p>Actor: The primary LLM that generates text.</p></li>
<li><p>Critic: The value function that estimates the value of a state.</p></li>
<li><p>Ref: The reference LLM that provides KL regularization.</p></li>
<li><p>Rew: The reward model that provides reward signals.</p></li>
</ul>
<p>The four model function calls and their dependencies are:</p>
<ul class="simple">
<li><p>Rollout: Generate text from the actor model.</p></li>
<li><p>InfReward: Infer rewards from the reward model given generated text.</p></li>
<li><p>InfRef: Infer log probabilities from the reference model given generated text.</p></li>
<li><p>InfValues: Infer values from the critic model given generated text.</p></li>
<li><p>TrainActor: Train the actor model given generated text, rewards, values, and reference log probabilities.</p></li>
<li><p>TrainCritic: Train the critic model given generated text, rewards, values, and reference log probabilities.</p></li>
</ul>
<p>This class resolves these dependencies under the hood.
What the users should specify are the runtime configurations
of models and allocations of <em>each model function call</em>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>is_sft_lora</strong> (<em>bool</em>) – Whether LoRA was used for SFT.
If so, the saved SFT model should only contain LoRA parameters.
Since LoRA is currently not supported for SFT,
this option is not used for now.</p></li>
<li><p><strong>sft_lora_path</strong> – Path to the LoRA model for SFT.
Since LoRA is currently not supported for SFT,
this option is not used for now.</p></li>
<li><p><strong>is_rw_lora</strong> (<em>bool</em>) – Whether LoRA was used for reward modeling.
If so, the saved reward model should only contain LoRA parameters
and the new reward head.
Since LoRA is currently not supported for reward modeling,
this option is not used for now.</p></li>
<li><p><strong>rw_lora_path</strong> (<em>str</em>) – Path to the LoRA model for reward modeling.
Since LoRA is currently not supported for reward modeling,
this option is not used for now.</p></li>
<li><p><strong>rew_head_path</strong> – Path to the new reward head for reward modeling.
Since LoRA is currently not supported for reward modeling,
this option is not used for now.</p></li>
<li><p><strong>actor</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Runtime configuration of the primary LLM.</p></li>
<li><p><strong>critic</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Runtime configuration of the critic model of PPO.</p></li>
<li><p><strong>ref</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Runtime configuration of the reference LLM.</p></li>
<li><p><strong>rew</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Runtime configuration of the reward LLM.</p></li>
<li><p><strong>actor_train</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – <a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a> for TrainActor.</p></li>
<li><p><strong>critic_train</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – <a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a> for TrainCritic.</p></li>
<li><p><strong>actor_gen</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – <a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a> for Rollout.</p></li>
<li><p><strong>critic_inf</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – <a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a> for InfValues.</p></li>
<li><p><strong>rew_inf</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – <a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a> for InfReward.</p></li>
<li><p><strong>ref_inf</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – <a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a> for InfRef.</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="#realhf.PromptOnlyDatasetConfig" title="realhf.PromptOnlyDatasetConfig"><em>PromptOnlyDatasetConfig</em></a>) – Dataset configuration.</p></li>
<li><p><strong>ppo</strong> (<a class="reference internal" href="#realhf.PPOHyperparameters" title="realhf.PPOHyperparameters"><em>PPOHyperparameters</em></a>) – Configuration for the PPO algorithm.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.GenerationConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">GenerationConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">experiment_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_name:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'???'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'slurm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'dev'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wandb_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'disabled'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recover_retries:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_worker_error:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_mode:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'pipe_model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation_use_cache:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_nodes:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_gpus_per_node:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodelist:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exp_ctrl:</span> <span class="pre">~realhf.api.core.system_api.ExperimentSaveEvalControl</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model:</span> <span class="pre">~realhf.api.quickstart.model.ModelTrainEvalConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gen:</span> <span class="pre">~realhf.api.core.model_api.GenerationHyperparameters</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset:</span> <span class="pre">~realhf.api.quickstart.dataset.PromptOnlyDatasetConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allocation:</span> <span class="pre">~realhf.api.quickstart.device_mesh.AllocationConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.GenerationConfig" title="Link to this definition">¶</a></dt>
<dd><p>Generation experiment configuration.</p>
<p>It is a subclass of <a class="reference internal" href="#realhf.CommonExperimentConfig" title="realhf.CommonExperimentConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">CommonExperimentConfig</span></code></a>,
so all CLI options in the base class are available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="#realhf.ModelTrainEvalConfig" title="realhf.ModelTrainEvalConfig"><em>ModelTrainEvalConfig</em></a>) – Model runtime configuration.</p></li>
<li><p><strong>gen_params</strong> (<a class="reference internal" href="#realhf.GenerationHyperparameters" title="realhf.GenerationHyperparameters"><em>GenerationHyperparameters</em></a>) – Generation hyperparameters.</p></li>
<li><p><strong>dataset</strong> (<a class="reference internal" href="#realhf.PromptOnlyDatasetConfig" title="realhf.PromptOnlyDatasetConfig"><em>PromptOnlyDatasetConfig</em></a>) – Dataset configuration</p></li>
<li><p><strong>allocation</strong> (<a class="reference internal" href="#realhf.AllocationConfig" title="realhf.AllocationConfig"><em>AllocationConfig</em></a>) – Device allocation and parallelism configuration.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="model-configurations">
<h2>Model Configurations<a class="headerlink" href="#model-configurations" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="realhf.ModelFamily">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">ModelFamily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_class</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_critic</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.ModelFamily" title="Link to this definition">¶</a></dt>
<dd><p>An identifier for the HF model type, e.g., llama, gpt2, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>_class</strong> (<em>str</em>) – The class of the model, e.g. “llama”.
It’s the registered name in the <code class="docutils literal notranslate"><span class="pre">register_hf_family</span></code> function.
Please check files in <code class="docutils literal notranslate"><span class="pre">realhf/api/from_hf</span></code>.</p></li>
<li><p><strong>size</strong> (<em>int</em>) – The size of the model. Only be used by the <code class="docutils literal notranslate"><span class="pre">search</span></code>
allocation mode. Can be 0 otherwise.</p></li>
<li><p><strong>is_critic</strong> (<em>bool</em>) – Whether the model is a critic or reward
instead of a normal LLM.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.ModelTrainEvalConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">ModelTrainEvalConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type:</span> <span class="pre">~realhf.api.core.config.ModelFamily</span> <span class="pre">=</span> <span class="pre">llama-7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backend:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'megatron'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lora:</span> <span class="pre">~realhf.api.quickstart.model.LoRAConfig</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_checkpointing:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_fp16:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_bf16:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offload:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_stage:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer:</span> <span class="pre">~realhf.api.quickstart.model.OptimizerConfig</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_critic_from_actor:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.ModelTrainEvalConfig" title="Link to this definition">¶</a></dt>
<dd><p>Model (or LLM) runtime configuration in ReaL.</p>
<p>We use a customized model class instead of HuggingFace’s.
Our customized model has the following highlights:</p>
<ol class="arabic simple">
<li><p>Support 3D parallelism and sequence parallelism.</p></li>
<li><p>Support flash attention for both training and generation.</p></li>
<li><p>Input sequences are packed into a single 1D tensor to save GPU memory and improve efficiency.</p></li>
</ol>
<p>The price is that we need to convert each HuggingFace model
of interest to this customized model manually.
Implemented models can be found in the <code class="docutils literal notranslate"><span class="pre">realhf/api/from_hf/</span></code> directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<a class="reference internal" href="#realhf.ModelFamily" title="realhf.ModelFamily"><em>ModelFamily</em></a>) – Model family type, e.g., llama, qwen2, etc.</p></li>
<li><p><strong>backend</strong> (<em>str</em>) – Backend for training.
Currently only “megatron” and “deepspeed” are supported.
For offloading parameters or optimizer states, use “deepspeed”.
For parameter reallocation, use “megatron”.</p></li>
<li><p><strong>path</strong> (<em>str</em>) – Path or identifier of the HuggingFace checkpoint.</p></li>
<li><p><strong>lora</strong> (<em>LoraConfig</em>) – Whether to use LoRA.</p></li>
<li><p><strong>gradient_checkpointing</strong> (<em>bool</em>) – Whether to use gradient checkpointing.</p></li>
<li><p><strong>enable_fp16</strong> (<em>bool</em>) – Whether to use fp16.</p></li>
<li><p><strong>enable_bf16</strong> (<em>bool</em>) – Whether to use bf16. Mutual exclusive with fp16.</p></li>
<li><p><strong>offload</strong> (<em>bool</em>) – Whether to offload model parameters to CPU.
Only valid for the deepspeed backend.</p></li>
<li><p><strong>parallel</strong> (<a class="reference internal" href="#realhf.ParallelismConfig" title="realhf.ParallelismConfig"><em>ParallelismConfig</em></a>) – Parallelism configuration.</p></li>
<li><p><strong>zero_stage</strong> (<em>int</em>) – Stage of ZeRO optimization.
Should be one of 0, 1, 2, 3.</p></li>
<li><p><strong>optimizer</strong> (<a class="reference internal" href="#realhf.OptimizerConfig" title="realhf.OptimizerConfig"><em>OptimizerConfig</em></a>) – Optimizer configuration.</p></li>
<li><p><strong>init_critic_from_actor</strong> (<em>bool</em>) – Whether to initialize a
critic/reward model from a saved LM checkpoint.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.OptimizerConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">OptimizerConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'empty'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weight_decay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_lr_ratio</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'cosine'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warmup_steps_proportion</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.02</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offload</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.OptimizerConfig" title="Link to this definition">¶</a></dt>
<dd><p>Optimizer configuration.</p>
<p>For models that will not be trained, its type should be “empty”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>str</em>) – Optimizer type. Currently only adam and empty optimizer are supported.</p></li>
<li><p><strong>lr</strong> (<em>float</em>) – Learning rate.</p></li>
<li><p><strong>weight_decay</strong> (<em>float</em>) – Weight decay.</p></li>
<li><p><strong>beta1</strong> (<em>float</em>) – Adam beta1.</p></li>
<li><p><strong>beta2</strong> (<em>float</em>) – Adam beta2.</p></li>
<li><p><strong>eps</strong> (<em>float</em>) – Adam epsilon in the denominator.</p></li>
<li><p><strong>min_lr_ratio</strong> (<em>float</em>) – Minimum learning rate ratio after learning rate annealing.
Should be in the interval of [0.0, 1.0].</p></li>
<li><p><strong>lr_scheduler_type</strong> (<em>str</em>) – Learning rate scheduler type.
One of “linear”, “cosine”, “constant”.</p></li>
<li><p><strong>warmup_steps_proportion</strong> (<em>float</em>) – Proportion of total training steps to warm up.
Should be in the interval of [0.0, 1.0].</p></li>
<li><p><strong>offload</strong> (<em>bool</em>) – Whether to offload optimizer to CPU.
Only valid for the deepspeed backend.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.ParallelismConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">ParallelismConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_parallel_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pipeline_parallel_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_parallel_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_sequence_parallel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.ParallelismConfig" title="Link to this definition">¶</a></dt>
<dd><p>Model 3D parallelism configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_parallel_size</strong> (<em>int</em>) – Tensor-model parallelism size.</p></li>
<li><p><strong>pipeline_parallel_size</strong> (<em>int</em>) – The number of pipeline parallelism stages.</p></li>
<li><p><strong>data_parallel_size</strong> (<em>int</em>) – Data parallelism size for ZeRO optimization.</p></li>
<li><p><strong>use_sequence_parallel</strong> (<em>bool</em>) – Whether to use sequence parallelism
in Megatron combined with tensor-model parallelism.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.AllocationConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">AllocationConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parallel:</span> <span class="pre">~realhf.api.quickstart.model.ParallelismConfig</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device_mesh:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.AllocationConfig" title="Link to this definition">¶</a></dt>
<dd><p>Allocation configuration for one RPC, used for manual allocation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parallel</strong> (<a class="reference internal" href="#realhf.ParallelismConfig" title="realhf.ParallelismConfig"><em>ParallelismConfig</em></a>) – Parallelism strategy configuration.</p></li>
<li><p><strong>device_mesh</strong> (<em>str</em>) – String representation for device mesh.
If it is composed of multiple nodes, it should be in the form of
slurm nodelist, e.g., node[01-02] or node01,node02.
If it is a slice on a single node,
we restrict it occupies 1, 2, 4, or 8 contiguous GPUs in the node.
In this case, the string representation is similar to the MPI hostfile, e.g.,
“node01:0,1,2,3” for the first 4 GPUs on node01.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.ReaLModelConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">ReaLModelConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_layers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_kv_heads</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_q_heads</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intermediate_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vocab_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_positions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embd_pdrop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resid_pdrop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attn_pdrop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_norm_epsilon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_function</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'gelu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_attn_by_inverse_layer_idx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_attn_weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_attention_bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_attn_proj_bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_norm_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mlp_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_rotary</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotary_base</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotary_interleaved</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotary_scaling</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotary_scaling_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_embed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abs_position_embedding_offset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_layernorm_before</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tied_embedding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sliding_window</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_critic</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gradient_accumulation_fusion</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.ReaLModelConfig" title="Link to this definition">¶</a></dt>
<dd><p>Configuration for ReaLModel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_layers</strong> (<em>int</em>) – Number of transformer blocks.</p></li>
<li><p><strong>n_kv_heads</strong> (<em>int</em>) – Number of key-value attention heads.</p></li>
<li><p><strong>n_q_heads</strong> (<em>int</em>) – Number of query attention heads.</p></li>
<li><p><strong>head_dim</strong> (<em>int</em>) – Dimension of each attention head.
If None, defaults to hidden_dim // n_q_heads.
If given, the query layer will have shape (hidden_dim, head_dim * n_q_heads).</p></li>
<li><p><strong>hidden_dim</strong> (<em>int</em>) – Hidden dimension of the transformer block.</p></li>
<li><p><strong>intermediate_dim</strong> (<em>int</em>) – Dimension of the intermediate layer in the MLP.</p></li>
<li><p><strong>vocab_size</strong> (<em>int</em>) – Vocabulary size.</p></li>
<li><p><strong>n_positions</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Maximum context length. Can be None for
rotary embedding, where the context length is decided during runtime.</p></li>
<li><p><strong>embd_pdrop</strong> (<em>float</em>) – Dropout probability for the embedding layer.</p></li>
<li><p><strong>resid_pdrop</strong> (<em>float</em>) – Dropout probability for the residual connections.</p></li>
<li><p><strong>attn_pdrop</strong> (<em>float</em>) – Dropout probability for the attention weights.</p></li>
<li><p><strong>layer_norm_epsilon</strong> (<em>float</em>) – Epsilon for layer normalization.</p></li>
<li><p><strong>activation_function</strong> (<em>str</em>) – Activation function for the MLP.</p></li>
<li><p><strong>scale_attn_by_inverse_layer_idx</strong> (<em>bool</em>) – Whether to scale the attention weights
by the inverse of the layer index.</p></li>
<li><p><strong>use_attention_bias</strong> (<em>bool</em>) – Whether to use bias for QKV layers.</p></li>
<li><p><strong>use_attn_proj_bias</strong> (<em>bool</em>) – Whether to use bias for the attention projection layer.</p></li>
<li><p><strong>layer_norm_type</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Type of layer normalization, can by None, “rms”, or “gemma”.</p></li>
<li><p><strong>mlp_type</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Type of the MLP. Either None or “llama”.</p></li>
<li><p><strong>apply_rotary</strong> (<em>bool</em>) – Whether to apply rotary embedding.</p></li>
<li><p><strong>rotary_base</strong> (<em>float</em>) – Exponential base for the rotary embedding.</p></li>
<li><p><strong>rotary_interleaved</strong> (<em>bool</em>) – Whether to use interleaved rotary embedding.</p></li>
<li><p><strong>rotary_scaling</strong> (<em>Optional</em><em>[</em><em>float</em><em>]</em>) – Scaling factor for the rotary embedding.</p></li>
<li><p><strong>rotary_scaling_type</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – Type of scaling for the rotary embedding.</p></li>
<li><p><strong>normalize_embed</strong> (<em>bool</em>) – Whether to normalize the embeddings
before transformer blocks. Used by Gemma.</p></li>
<li><p><strong>abs_position_embedding_offset</strong> (<em>int</em>) – Offset for the absolute position embedding.
Used by OPT, but OPT is currently not supported.</p></li>
<li><p><strong>do_layernorm_before</strong> (<em>bool</em>) – Whether to apply layer normalization before the attention
rather than after. Used by OPT, but OPT is currently not supported.</p></li>
<li><p><strong>tied_embedding</strong> (<em>bool</em>) – Whether to share the embeddings and output weights.
Used by models like GPT-2 and Gemma.</p></li>
<li><p><strong>sliding_window</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) – Sliding window size for the attention.
Currently a placeholder and not supported.</p></li>
<li><p><strong>is_critic</strong> (<em>bool</em>) – Whether the model is a critic model.</p></li>
<li><p><strong>gradient_accumulation_fusion</strong> (<em>bool</em>) – Whether to fuse
gradient accumulation in Megatron.
Currently not supported.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="dataset-configurations">
<h2>Dataset Configurations<a class="headerlink" href="#dataset-configurations" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="realhf.PromptAnswerDatasetConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">PromptAnswerDatasetConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seqlen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_bs_n_seqs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_bs_n_seqs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.PromptAnswerDatasetConfig" title="Link to this definition">¶</a></dt>
<dd><p>Datasets used for SFT.</p>
<p>The raw data must be a json or jsonl file, where each piece of data is a dictionary
with keys <cite>prompt</cite> and <cite>answer</cite>. Both <cite>prompt</cite> and <cite>answer</cite> are strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_path</strong> (<em>str</em>) – Path to the training dataset.</p></li>
<li><p><strong>valid_path</strong> (<em>str</em>) – Path to the evaluation dataset.</p></li>
<li><p><strong>max_seqlen</strong> (<em>int</em>) – Maximum sequence length (prompt + answer).
Sequences longer than this will be truncated.</p></li>
<li><p><strong>train_bs_n_seqs</strong> (<em>int</em>) – Number of sequences in each batch during training.</p></li>
<li><p><strong>valid_bs_n_seqs</strong> (<em>int</em>) – Number of sequences in each batch during validation.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.PairedComparisonDatasetConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">PairedComparisonDatasetConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_pairs_per_prompt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seqlen</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1024</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_bs_n_seqs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_bs_n_seqs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.PairedComparisonDatasetConfig" title="Link to this definition">¶</a></dt>
<dd><p>Datasets used for paired-comparison reward modeling and DPO.</p>
<p>The raw data must be a json or jsonl file, where each piece of data is a dictionary
with keys <cite>prompt</cite>, <cite>pos_answers</cite>, and <cite>neg_answers</cite>. <cite>prompt</cite> is a string.
<cite>pos_answers</cite> and <cite>neg_answers</cite> are lists of strings. They must have the same size.</p>
<p>Answer pairs of the same prompt will be sampled in the same batch. Hence, the number of sequences
in each batch must be even, in the form of [P1A1+, P1A1-, P1A2+, P1A2-, P2A1+, P2A1-, P2A2+, P2A2-, …],
where <cite>P</cite> means prompt, <cite>A</cite> means answer, <cite>+</cite> means positive, and <cite>-</cite> means negative.</p>
<p>The raw dataset may contain multiple answer pairs for each prompt. We will randomly sample
<cite>max_pairs_per_prompt</cite> answer pairs for each prompt in each epoch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_path</strong> (<em>str</em>) – Path to the training dataset.</p></li>
<li><p><strong>valid_path</strong> (<em>str</em>) – Path to the evaluation dataset.</p></li>
<li><p><strong>max_pairs_per_prompt</strong> (<em>int</em>) – Maximum number of answer pairs per prompt.</p></li>
<li><p><strong>max_seqlen</strong> (<em>int</em>) – Maximum sequence length (prompt + answer).
Sequences longer than this will be truncated.</p></li>
<li><p><strong>train_bs_n_seqs</strong> (<em>int</em>) – Number of sequences in each batch during training.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="realhf.PromptOnlyDatasetConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">PromptOnlyDatasetConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_prompt_len</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_bs_n_seqs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">256</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.PromptOnlyDatasetConfig" title="Link to this definition">¶</a></dt>
<dd><p>Datasets used for PPO RLHF.</p>
<p>The raw data must be a json or jsonl file, where each piece of data is a dictionary
with a single key called <cite>prompt</cite>, which is a string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – Path to the training dataset.</p></li>
<li><p><strong>max_prompt_len</strong> (<em>int</em>) – Maximum prompt length.
Prompts longer than this will be truncated.</p></li>
<li><p><strong>train_bs_n_seqs</strong> (<em>int</em>) – Number of prompts in each batch.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="sequencesample">
<h2><code class="docutils literal notranslate"><span class="pre">SequenceSample</span></code><a class="headerlink" href="#sequencesample" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">SequenceSample</span></code> is an object we use in model function calls.</p>
<dl class="py class">
<dt class="sig sig-object py" id="realhf.SequenceSample">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">SequenceSample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">keys:</span> <span class="pre">~typing.Set[str],</span> <span class="pre">trailing_shapes:</span> <span class="pre">~typing.Dict[str,</span> <span class="pre">~torch.Size</span> <span class="pre">|</span> <span class="pre">~typing.Tuple</span> <span class="pre">|</span> <span class="pre">None],</span> <span class="pre">dtypes:</span> <span class="pre">~typing.Dict[str,</span> <span class="pre">~torch.dtype</span> <span class="pre">|</span> <span class="pre">None],</span> <span class="pre">ids:</span> <span class="pre">~typing.List[~typing.Hashable],</span> <span class="pre">seqlens:</span> <span class="pre">~typing.Dict[str,</span> <span class="pre">~typing.List[~torch.Tensor]],</span> <span class="pre">data:</span> <span class="pre">~typing.Dict[str,</span> <span class="pre">~torch.Tensor</span> <span class="pre">|</span> <span class="pre">None]</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">metadata:</span> <span class="pre">~typing.Dict[str,</span> <span class="pre">~typing.Any]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.SequenceSample" title="Link to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="realhf.SequenceSample.meta">
<span class="sig-name descname"><span class="pre">meta</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#realhf.SequenceSample" title="realhf.api.core.data_api.SequenceSample"><span class="pre">SequenceSample</span></a></span></span><a class="headerlink" href="#realhf.SequenceSample.meta" title="Link to this definition">¶</a></dt>
<dd><p>Create a new SequenceSample that does not contain any data.</p>
</dd></dl>

</dd></dl>

</section>
<section id="dataflow-graph">
<h2>Dataflow Graph<a class="headerlink" href="#dataflow-graph" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="realhf.MFCDef">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">realhf.</span></span><span class="sig-name descname"><span class="pre">MFCDef</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_seqs:</span> <span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface_type:</span> <span class="pre">~realhf.api.core.config.ModelInterfaceType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface_impl:</span> <span class="pre">~realhf.api.core.config.ModelInterfaceAbstraction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">~realhf.api.core.config.ModelName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_keys:</span> <span class="pre">~typing.Tuple</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_key_remap:</span> <span class="pre">~typing.Dict[str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_keys:</span> <span class="pre">~typing.Tuple</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_key_remap:</span> <span class="pre">~typing.Dict[str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">balanced_dp:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_return_value:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_type:</span> <span class="pre">~typing.Any</span> <span class="pre">|</span> <span class="pre">~realhf.api.core.config.ModelFamily</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_path:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_G:</span> <span class="pre">~networkx.classes.digraph.DiGraph</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_pre_hooks:</span> <span class="pre">~typing.List[~realhf.api.core.dfg.OffloadHook</span> <span class="pre">|</span> <span class="pre">~realhf.api.core.dfg.SyncParamHook]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_post_hooks:</span> <span class="pre">~typing.List[~realhf.api.core.dfg.OffloadHook</span> <span class="pre">|</span> <span class="pre">~realhf.api.core.dfg.SyncParamHook]</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#realhf.MFCDef" title="Link to this definition">¶</a></dt>
<dd><p>A model function call (MFC) object used by the workers.</p>
<p>MFC is the abbreviation of Model Function Call.
This object serves as the user interface for developing
new algorithms.
This object will be inserted in a nx.DiGraph as nodes.
Edges will be automatically resolved by input/output keys.</p>
<p>Fields starting with an underscore will be filled automatically.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The unique identifier of this model function call.</p></li>
<li><p><strong>n_seqs</strong> (<em>int</em>) – The number of sequences to be processed in a batch.</p></li>
<li><p><strong>interface_type</strong> (<em>ModelInterfaceType</em>) – The interface type to be used
by the node (e.g., generate, train_step).</p></li>
<li><p><strong>interface_impl</strong> (<a class="reference internal" href="customization.html#realhf.ModelInterface" title="realhf.ModelInterface"><em>ModelInterface</em></a>) – The actual interface implementation
when running the this node.</p></li>
<li><p><strong>model_name</strong> (<em>str</em><em> or </em><em>ModelName</em>) – The model identifier to be used by the node,
corresponding to an unique LLM. The user-provided model name
can just be a string. The replica ID will be resolved in ReaL.</p></li>
<li><p><strong>input_keys</strong> (<em>Tuple</em>) – Input data keys, used to resolve dependencies.</p></li>
<li><p><strong>output_keys</strong> (<em>Tuple</em>) – Output data keys, used to resolve dependencies.</p></li>
<li><p><strong>input_key_remap</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – Remap input keys to let the interface implementation
recognize them. Keys are <code class="docutils literal notranslate"><span class="pre">input_keys</span></code> and values are the identifiers known to the
interface. We use remap to keep our interface code clean.</p></li>
<li><p><strong>output_key_remap</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>str</em><em>]</em>) – Remap output keys to let MFC recognize them.
Keys are identifiers known to the interface and values are <code class="docutils literal notranslate"><span class="pre">output_keys</span></code>.</p></li>
<li><p><strong>balanced_dp</strong> (<em>bool</em>) – Whether to balance the data parallelism such that
each DP rank will get exactly n_seqs // dp_size sequences.
If set to False, ReaL will do partition according to the number of tokens.
If the lengths of sequences are not uniform, it may lead to unbalanced
sequence numbers, but balanced memory usage.</p></li>
<li><p><strong>log_return_value</strong> (<em>bool</em>) – Whether to log the return value of the interface implementation.</p></li>
<li><p><strong>model_type</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#realhf.ModelFamily" title="realhf.ModelFamily"><em>ModelFamily</em></a><em>]</em>) – The specification of the LLM, e.g., LLaMA-7B.
Used by the profiler and search engine to produce an optimal execution plan.
Can be omited if the search engine is not used.</p></li>
<li><p><strong>model_path</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – The path to the model file. Used to get the config
for the search engine.
Can be omited if the search engine is not used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>

</article>
        <aside class="nftt-toc">
          
          <div class="mt-3 mb-1 my-lg-0 ps-xl-3 text-muted">
            <button class="btn btn-link link-dark p-lg-0 mb-2 mb-lg-0 text-decoration-none nftt-toc-toggle d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#tocContents" aria-expanded="false" aria-controls="tocContents"
            >On this page <i class="ms-2 bi bi-chevron-expand"></i></button>
            <div class="title d-none d-lg-block">
              <i class="bi bi-file-earmark-text"></i>&nbsp;&nbsp;<span class="small">On this page</span>
            </div>
            <div class="collapse nftt-toc-collapse" id="tocContents">
              <nav id="TableOfContents">
                <ul>
<li><a class="reference internal" href="#">Configurations</a><ul>
<li><a class="reference internal" href="#experiment-configurations">Experiment Configurations</a><ul>
<li><a class="reference internal" href="#realhf.ExperimentSaveEvalControl"><code class="docutils literal notranslate"><span class="pre">ExperimentSaveEvalControl</span></code></a></li>
<li><a class="reference internal" href="#realhf.CommonExperimentConfig"><code class="docutils literal notranslate"><span class="pre">CommonExperimentConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.SFTConfig"><code class="docutils literal notranslate"><span class="pre">SFTConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.RWConfig"><code class="docutils literal notranslate"><span class="pre">RWConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.DPOConfig"><code class="docutils literal notranslate"><span class="pre">DPOConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.GenerationHyperparameters"><code class="docutils literal notranslate"><span class="pre">GenerationHyperparameters</span></code></a></li>
<li><a class="reference internal" href="#realhf.PPOHyperparameters"><code class="docutils literal notranslate"><span class="pre">PPOHyperparameters</span></code></a></li>
<li><a class="reference internal" href="#realhf.PPOConfig"><code class="docutils literal notranslate"><span class="pre">PPOConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.GenerationConfig"><code class="docutils literal notranslate"><span class="pre">GenerationConfig</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#model-configurations">Model Configurations</a><ul>
<li><a class="reference internal" href="#realhf.ModelFamily"><code class="docutils literal notranslate"><span class="pre">ModelFamily</span></code></a></li>
<li><a class="reference internal" href="#realhf.ModelTrainEvalConfig"><code class="docutils literal notranslate"><span class="pre">ModelTrainEvalConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.OptimizerConfig"><code class="docutils literal notranslate"><span class="pre">OptimizerConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.ParallelismConfig"><code class="docutils literal notranslate"><span class="pre">ParallelismConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.AllocationConfig"><code class="docutils literal notranslate"><span class="pre">AllocationConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.ReaLModelConfig"><code class="docutils literal notranslate"><span class="pre">ReaLModelConfig</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#dataset-configurations">Dataset Configurations</a><ul>
<li><a class="reference internal" href="#realhf.PromptAnswerDatasetConfig"><code class="docutils literal notranslate"><span class="pre">PromptAnswerDatasetConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.PairedComparisonDatasetConfig"><code class="docutils literal notranslate"><span class="pre">PairedComparisonDatasetConfig</span></code></a></li>
<li><a class="reference internal" href="#realhf.PromptOnlyDatasetConfig"><code class="docutils literal notranslate"><span class="pre">PromptOnlyDatasetConfig</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sequencesample"><code class="docutils literal notranslate"><span class="pre">SequenceSample</span></code></a><ul>
<li><a class="reference internal" href="#realhf.SequenceSample"><code class="docutils literal notranslate"><span class="pre">SequenceSample</span></code></a><ul>
<li><a class="reference internal" href="#realhf.SequenceSample.meta"><code class="docutils literal notranslate"><span class="pre">SequenceSample.meta()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dataflow-graph">Dataflow Graph</a><ul>
<li><a class="reference internal" href="#realhf.MFCDef"><code class="docutils literal notranslate"><span class="pre">MFCDef</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </nav>
            </div>
          </div>
          
        </aside>
      </div>
    </div>

    <footer class="nftt-footer">
      <nav id="paginator" class="py-4" aria-label="Documentation navigation">
    <div class="container">
      <ul class="pagination justify-content-between mb-0"><li class="page-item">
            <a href="install.html" class="d-flex px-5 align-items-end" rel="prev" aria-label="Previous page: Installation">
              <span class="prev-page"><i class="bi bi-caret-left"></i></span>
              <div class="d-flex flex-column">
                <span class="text-small text-start text-muted">Previous</span>
                <span class="underline">Installation</span>
              </div>
            </a>
          </li>
        <li class="page-item ms-auto">
            <a href="quickstart.html" class="d-flex px-5 align-items-end" rel="next" aria-label="Next page: Quickstart">
              <div class="d-flex flex-column">
                <span class="text-small text-end text-start text-muted">Next</span>
                <span class="underline">Quickstart</span>
              </div>
              <span class="next-page"><i class="bi bi-caret-right"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
  </nav>

      <div class="py-5 px-4 px-md-3">
  <div class="container">
    

    <div class="row">
      <div class="col-lg-12 text-center">
        <a class="brand-text d-inline-flex align-items-center mb-2 text-decoration-none" href="/" aria-label="Nefertiti-for-Sphinx">
          <span class="fs-6 fw-bold">ReaL</span>
        </a>
        
          <ul class="list-unstyled small text-muted">
            <li>2024, Wei Fu & Zhiyu Mei</li>
          </ul>
        
        
        <div class="built-with pt-2">
          Built with <a href="http://sphinx-doc.org">Sphinx 7.3.7</a> and <a href="https://github.com/danirus/sphinx-nefertiti">Nefertiti 0.3.4</a>
        </div>
        
      </div>
    </div>
  </div>
</div>
    </footer>
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>

    <script type="text/javascript" src="_static/sphinx-nefertiti-0.3.4.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap.bundle-0.3.4.min.js"></script>
    
    <script type="text/javascript" src="_static/doc_versions.js"></script>
  </body>
</html>